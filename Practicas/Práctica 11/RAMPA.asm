#include registers.inc

		ORG $3E70
		DW RTI_ISR

		ORG $1000
CONT_AD:	DS 2	
		
		ORG $1500
		BSET DDRM,$40
		MOVB #$54,RTICTL
		BSET CRGINT,$80
		MOVB #$50,SPI0CR1
		MOVB #$00,SPI0CR2
		MOVB #$45,SPI0BR
		MOVW #$0000,CONT_AD
		BSET PTM,$40
		CLI 
		LDS #$3BFF
		BRA *


RTI_ISR:	LDAA SPI0SR
		LDD CONT_AD
		LSLD 
		LSLD 
		ADDA #$90
		BCLR PTM,$40
		STAA SPI0DR
LOOP2:		BRCLR SPI0SR,$20,LOOP2 
		STAB SPI0DR
LOOP3:		BRCLR SPI0SR,$20,LOOP3 
		BSET PTM,$40
		LDY CONT_AD
		INY 
		STY CONT_AD
		LDD #1023
		CPD CONT_AD
		BNE SALIR
		MOVW #$0000,CONT_AD
SALIR:		BSET CRGFLG,$80
		RTI 
